# Advanced OMICS Project 

## About Project Data
These are HIV proviral sequence from Patient samples in the `spleen` and `brains` of individuals living with HIV. They were sequenced using the `nanopore sequencer`. The directory contains the aligned reads for 3 samples, 2 `MFG (mid-frontal girus)` and 1 `(SPL) spleen` from 2 individuals.
These are human samples from the `National Neuro AIDS Tissue Consortium (NNTC)`.

`Barcode 10` and `barcode 12` samples are from the `MFG (mid-frontal girus)` while `barcode 11` is from the `(SPL) spleen`

## Data File
Data used for this analysis were .bam and indexed .bam files. 
The `data` itself however can be found in the path :

`cd ~/share/courses/OMICS/hivbrain/`

This path has both the .bam files and the index files. 

## Pipeline
The goal was to convert `.bam` file using `samtools sort`. After which a `bcftools mpileup` will be performed on the `sorted .bam file`. Then variants would be called using `bcftools call`

### Commands used in pipeline
`samtools sort -o HIVsorted.bam barcode10.rg.bam`:Ths was used to convert .bam to a sorted .bam file (Input: barcode10.rg.bam ;Output:HIVsorted.bam)

`bcftools mpileup -r HXB2F -Ou -f ~/common/references/hg38hxb2f.fasta ~/common/references/HIVsorted.bam | bcftools call --ploidy 1 -mv -Ob -o HIV2.bcf`: This was used to call variants in a .bcf format (Input: path to reference genome-hg38hxb2f.fasta, path to sorted .bam file; Ouput: HIV2.bcf) 

`bcftools stats HIV2.bcf | grep '^SN'`: This was to look at the SNPs and Indels in the .bcf file (Input:HIV2.bcf)

`bcftools view barcode10.bcf -O v -o barcode10.vcf`: This was to convert a `.bcf file` to a `.vcf file` (Input:barcode10.bcf; Output:barcode10.vcf)

The vcf files for the barcode samples can be found at `cd ~/common/WKD/scripttest/ `. Each in its own folder or directory.

## Bash script
A bash script was written to streamline the process,in order to issue a single command that will take initial `.bam files` through the pipeline. This prevents tidious work of typing long commands for each individal `.bam file` 
The bash script is named `bcfscript.sh` and it is attached. It can also be found at `cd ~/common/hivbrain`

### Command used to make the command executable 
`chmod +x bcfscript.sh` 

### Command used to execute/run the bash script
In order to convert the sorted bam file  `barcode10.rg.bam` to a bcf file, the bash script `bcfscript.sh` was used and the command below was used to execute/run it. 

`source bcfscript.sh ~/share/courses/OMICS/hivbrain/barcode10.rg.bam scripttest/barcode10.bcf`(Input: file path to barcode10.rg.bam; Output: file path to barcode10.bcf)

### Annotating the effects of variants with snpeFF 
snpeFF takes a regular vcf file generated by bcftools and add new annotations to qualify the effects of variants identified by bcftools. The command below converts vcf files generated by bcftools into snpeff.vcf files
`snpEff eff -c /data/share/courses/OMICS/hivbrain/snpeff-db/snpEff.config HXB2F barcode10.vcf > barcode10.snpeff.vcf`. (Input: reference genome-HXB2F and file-barcode10.vcf; Output-barcode10.snpeff.vcf)

The path to the snpeff.vcf files for each of the three barcode samples is at:`cd ~/common/WKD/scripttest/ `. Each in its own folder or directory. The summary html files are attached 

### Viewing particular variant effects 
After generating snpeff vcf files, particular variants effects can be viewed using bcftools view and grep. To view for example, variants that have high impact the command below was used.

`bcftools view merged.snpeff.vcf |grep 'HIGH'`

### Filtering out particular variant effects
After using snpeff to annotate the effects of the variants generated by bcftools i out particular variants. An example was variant the variant with `HIGH` impact. This is likely to be caused by nonsense or frameshift mutations which have serious or deleterious effect on the gene like an introduction of a `stop codon`. This can lead to the formation of a truncated or non functional protein. An example of such command i used is listed below. 

`bcftools view -i 'INFO/ANN~"HIGH"' barcode10.snpeff.vcf -o high_variants.vcf`(Input: effect of variant-HIGH; file-barcode10.snpeff.vcf; output-high_variants.vcf)

### Creating a makefile(s) that generate a merged vcf or merged.snpeff.vcf files
The `first` makefile generates a single `merged.vcf` file using the `sorted .bam files` as its input. The `second` makefile called `makefile1` uses the `merged.vcf` file generated from the `first makefile` as its input to create a singe `merged.snpeff.vcf file`.

The execution of the first makefile is done by typing `make`. The path to the merged.vcf file is `cd ~/common/hivbrain`

The execution of the second makefile is done by typing `make -f makefile1`. Path to the merged.snpeff.vcf file is `cd ~/common/hivbrain`

However the first makefile must be executed before executing makefile1
Both makefiles are attached. 

### Challenges
Adding multiple levels of targets and dependencies was my biggest challenge in regards to creating a makefile. I had initially wanted to make a single makefile the takes sorted bam files and merge them into a single snpEff vcf file. However, i couldnt get the target which is the merged.snpeff.vcf file to recognize its dependent merged.vcf file (generated from bcftools variant calling ).  i therefore decided to split it into two make files and executed them as stated above. 

### Observation/Discussion
In a paper by Mele et al, they indicated that Tat is synthesized by two exons, which results in a 101 amino acid protein called Tat101. However, they asserted that alot of the publications involving Tat were on Tat86 and Tat72 even though the predominant Tat in subtype B is Tat101. They however stated that in subtypes like subtype D and H, current sequences available indicate a Tat86 dominance. Tat 101 has also been shown to reduce inate immune response by downregulating interferon-stimulating genes and significantly increasing the expression of IL-2 which is required for T cell proliferation. This was not seen in its truncated version, Tat72. It is therefore makes the second exon of tat the distinguisher between the functional properties of full length Tat and its truncated versions. (Mele et al., 2020). Searching through the high impact variants i found out that barcode 10 had a single high impact variation at position 8388. Barcode 11 has 3 high impact variants at position 1156, 2360 and 8388. Then barcode 12 had 4 high impact variants at position 907, 961, 1000 and 8462. The first exon of Tat is known to be between position 5834-6048 and the second exon of Tat to be around position 8368-8456. Based on the sequences, it indicates that barcode 10 and 11 HIV provirus are likely to have a truncated version of Tat due to the the stop gained mutation at position 8388 for both. For barcode 12, due to the fact that the mutation is at the end of exon 2 it is difficult to state if the exon itself is affected since estimation put exon 2 between 8368-8456 or 8379-8469. (Castro-Nallar et al., 2012). Barcode 11 and 12 had other high impact mutations primarily in the gag region of the provirus and the pol region too. For the purposes of CRSIPR work in Drs. Wigdahl, Nonnemacher and Dampier labs it was worth noting that there were not variants in the LTR regions of the provirus substantiating the case that that the LTR is a good target for CRSIPR editing.

### Future Directions
**i** To write a script to call out variants within the region of the HIV  provirus ocuupied by the second exon of tat.

**ii** It has been shown that most of the latent provirus are defective and not replicative competent (Reeves et al., 2023). It will therefore be interesting to understand what high impact variants contribute to this phenotype. And subsequently try to understand how they arise 

### References
1. Reeves, D. B., Gaebler, C., Oliveira, T. Y., Peluso, M. J., Schiffer, J. T., Cohn, L. B., Deeks, S. G., & Nussenzweig, M. C. (2023). Impact of misclassified defective proviruses on HIV reservoir measurements. Nature Communications, 14(1), 4186. https://doi.org/10.1038/s41467-023-39837-z

2.Castro-Nallar, E., Crandall, K. A., & Pérez-Losada, M. (2012). Genetic diversity and molecular epidemiology of HIV transmission. Future Virology, 7(3), 239–252. https://doi.org/10.2217/fvl.12.4

3. Mele, A. R., Marino, J., Dampier, W., Wigdahl, B., & Nonnemacher, M. R. (2020). HIV-1 Tat Length: Comparative and Functional Considerations. Frontiers in Microbiology, 11, 444. https://doi.org/10.3389/fmicb.2020.00444
